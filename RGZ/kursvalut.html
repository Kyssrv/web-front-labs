<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—É—Ä—Å –≤–∞–ª—é—Ç - –í—ã–±–æ—Ä–≥—Å–∫–∏–π —Å—É–¥–æ—Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–≤–æ–¥</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        header {
            background-color: #003366;
            color: white;
            padding: 20px;
            text-align: center;
        }
        main {
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        .currency-section, .chart-section {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            color: #003366;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .converter-container {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        .converter-box {
            flex: 1;
        }
        input {
            width: 100%;
            padding: 10px;
            margin: 5px 0 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        button {
            background-color: #003366;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
        }
        button:hover {
            background-color: #004080;
        }
        .exchange-rate-info {
            background-color: #f0f7ff;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
        }
        .chart-container {
            margin-top: 20px;
            position: relative;
            height: 400px;
        }
        .chart-info {
            background-color: #f0f7ff;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            display: none;
        }
        .bottom-menu {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #003366;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
        }
        .bottom-menu a {
            color: white;
            text-decoration: none;
            font-size: 20px;
            text-align: center;
        }
        .bottom-menu a:hover {
            color: #4d9de0;
        }
        @media (max-width: 768px) {
            .converter-container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>–ö—É—Ä—Å –≤–∞–ª—é—Ç</h1>
    </header>

    <main>
        <section class="currency-section">
            <h2>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≤–∞–ª—é—Ç</h2>
            
            <div class="converter-container">
                <div class="converter-box">
                    <label for="rub-amount">–†—É–±–ª–∏ (RUB)</label>
                    <input type="number" id="rub-amount" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É" min="0" step="0.01">
                    <button onclick="convert('rub-to-rsd')">RUB ‚Üí RSD</button>
                </div>
                
                <div class="converter-box">
                    <label for="rsd-amount">–°–µ—Ä–±—Å–∫–∏–µ –¥–∏–Ω–∞—Ä—ã (RSD)</label>
                    <input type="number" id="rsd-amount" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É" min="0" step="0.01">
                    <button onclick="convert('rsd-to-rub')">RSD ‚Üí RUB</button>
                </div>
            </div>
            
            <div class="exchange-rate-info">
                <p>–¢–µ–∫—É—â–∏–π –∫—É—Ä—Å: 1 RSD = <span id="current-rate">...</span> RUB</p>
                <p>–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: <span id="update-date">...</span></p>
            </div>
        </section>
        <section class="chart-section">
            <h2>–î–∏–Ω–∞–º–∏–∫–∞ –∫—É—Ä—Å–∞ —Å–µ—Ä–±—Å–∫–æ–≥–æ –¥–∏–Ω–∞—Ä–∞ (RSD)</h2>
            <div class="chart-container">
                <canvas id="currency-chart"></canvas>
            </div>
            <div class="chart-info" id="chart-info"></div>
            <div style="margin-top: 20px;">
                <label for="days-range">–ü–µ—Ä–∏–æ–¥ (–¥–Ω–µ–π):</label>
                <input type="range" id="days-range" min="30" max="365" value="30" step="1" oninput="updateDaysValue()">
                <span id="days-value">30</span>
                <button onclick="loadChartData()">–û–±–Ω–æ–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫</button>
            </div>
        </section>
    </main>

    <!-- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –º–µ–Ω—é –≤–Ω–∏–∑—É -->
    <div class="bottom-menu">
        <a href="index2.html" title="–û –∫–æ–º–ø–∞–Ω–∏–∏"><i class="icon">üè¢</i></a>
        <a href="news2.html" title="–ù–æ–≤–æ—Å—Ç–∏"><i class="icon">üì∞</i></a>
        <a class="active" href="kursvalut.html" title="–ö—É—Ä—Å –≤–∞–ª—é—Ç"><i class="icon">üí±</i></a>
        <a href="contacts2.html" title="–ö–æ–Ω—Ç–∞–∫—Ç—ã"><i class="icon">üìû</i></a>
        <a href="video2.html" title="–í–∏–¥–µ–æ"><i class="icon">üé•</i></a>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentRate = 0;
        let currencyChart;
        let currentDates = [];
        let currentRates = [];

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            loadCurrentRate();
            loadChartData();
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –∫—É—Ä—Å–∞
        async function loadCurrentRate() {
            try {
                const response = await fetch('https://www.cbr-xml-daily.ru/daily_json.js');
                const data = await response.json();
                
                // –ù–∞—Ö–æ–¥–∏–º –∫—É—Ä—Å —Å–µ—Ä–±—Å–∫–æ–≥–æ –¥–∏–Ω–∞—Ä–∞ (RSD)
                const rsdRate = data.Valute['RSD'];
                currentRate = rsdRate.Value / rsdRate.Nominal;
                
                document.getElementById('current-rate').textContent = currentRate.toFixed(4);
                document.getElementById('update-date').textContent = new Date(data.Date).toLocaleDateString('ru-RU');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫—É—Ä—Å–∞:', error);
                document.getElementById('current-rate').textContent = '–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤–∞–ª—é—Ç
        function convert(direction) {
            if (!currentRate) {
                alert('–ö—É—Ä—Å –≤–∞–ª—é—Ç –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...');
                return;
            }

            if (direction === 'rub-to-rsd') {
                const rubAmount = parseFloat(document.getElementById('rub-amount').value);
                if (isNaN(rubAmount) || rubAmount < 0) {
                    alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É');
                    return;
                }
                const rsdAmount = rubAmount / currentRate;
                document.getElementById('rsd-amount').value = rsdAmount.toFixed(2);
            } else {
                const rsdAmount = parseFloat(document.getElementById('rsd-amount').value);
                if (isNaN(rsdAmount) || rsdAmount < 0) {
                    alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É');
                    return;
                }
                const rubAmount = rsdAmount * currentRate;
                document.getElementById('rub-amount').value = rubAmount.toFixed(2);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
        async function loadChartData() {
            const days = parseInt(document.getElementById('days-range').value);
            
            try {
                const endDate = new Date();
                const startDate = new Date();
                startDate.setDate(endDate.getDate() - days);
                
                const dates = [];
                const rates = [];
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –¥–∞—Ç –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤
                for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                    dates.push(new Date(d));
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–π –¥–∞—Ç—ã
                for (const date of dates) {
                    try {
                        const dateStr = date.toISOString().split('T')[0];
                        const url = https://www.cbr-xml-daily.ru/archive/${date.getFullYear()}/${(date.getMonth()+1).toString().padStart(2, '0')}/${date.getDate().toString().padStart(2, '0')}/daily_json.js;
                        
                        const response = await fetch(url);
                        const data = await response.json();
                        
                        if (data.Valute && data.Valute['RSD']) {
                            const rsdRate = data.Valute['RSD'];
                            rates.push({
                                date: new Date(date),
                                rate: rsdRate.Value / rsdRate.Nominal
                            });
                        }
                    } catch (error) {
                        console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∑–∞ ${date.toLocaleDateString()}:`, error);
                    }
                }
                
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –¥–∞—Ç–µ
                rates.sort((a, b) => a.date - b.date);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –∫–ª–∏–∫–µ
                currentDates = rates.map(item => item.date);
                currentRates = rates.map(item => item.rate);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫
                updateChart(rates.map(item => item.date), rates.map(item => item.rate));
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö:', error);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
        function updateChart(dates, rates) {
            const ctx = document.getElementById('currency-chart').getContext('2d');
            
            // –ï—Å–ª–∏ –≥—Ä–∞—Ñ–∏–∫ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —É–Ω–∏—á—Ç–æ–∂–∞–µ–º –µ–≥–æ
            if (currencyChart) {
                currencyChart.destroy();
            }
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –≥—Ä–∞—Ñ–∏–∫
            currencyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dates.map(date => date.toLocaleDateString('ru-RU')),
                    datasets: [{
                        label: '–ö—É—Ä—Å RSD (—Ä—É–±)',
                        data: rates,
                        backgroundColor: 'rgba(0, 99, 132, 0.6)',
                        borderColor: 'rgba(0, 99, 132, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: '–ö—É—Ä—Å (—Ä—É–±)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: '–î–∞—Ç–∞'
                            }
                        }
                    },
                    onClick: (e, activeElements) => {
                        if (activeElements.length > 0) {
                            const index = activeElements[0].index;
                            const date = currentDates[index].toLocaleDateString('ru-RU');
                            const rate = currentRates[index].toFixed(4);
                            
                            document.getElementById('chart-info').innerHTML = `
                                <p><strong>–î–∞—Ç–∞:</strong> ${date}</p>
                                <p><strong>–ö—É—Ä—Å:</strong> 1 RSD = ${rate} RUB</p>
                            `;
                            document.getElementById('chart-info').style.display = 'block';
                            
                            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å—Ç–æ–ª–±–µ—Ü
                            currencyChart.data.datasets[0].backgroundColor = currentRates.map((_, i) => 
                                i === index ? 'rgba(255, 99, 132, 0.6)' : 'rgba(0, 99, 132, 0.6)'
                            );
                            currencyChart.update();
                        }
                    }
                }
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª–∑—É–Ω–∫–∞
        function updateDaysValue() {
            document.getElementById('days-value').textContent = document.getElementById('days-range').value;
        }
    </script>
</body>
</html>